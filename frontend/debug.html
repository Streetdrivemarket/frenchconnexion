<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - French Connexion‚Ñ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 40px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            padding: 30px;
            border: 2px solid #00ff00;
            border-radius: 10px;
        }

        h1 {
            color: #fff;
            margin-bottom: 30px;
            text-align: center;
        }

        .info-block {
            background: #0a0a0a;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #00ff00;
        }

        .label {
            color: #fff;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .value {
            color: #00ff00;
            word-break: break-all;
            font-size: 14px;
        }

        .warning {
            color: #ff0000;
        }

        .success {
            color: #00ff00;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            display: block;
            width: 100%;
        }

        button:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öúÔ∏è DEBUG PANEL - French Connexion‚Ñ¢</h1>

        <div class="info-block">
            <div class="label">üåç Domaine actuel:</div>
            <div class="value" id="domain"></div>
        </div>

        <div class="info-block">
            <div class="label">üîå URL de l'API backend:</div>
            <div class="value" id="apiUrl"></div>
        </div>

        <div class="info-block">
            <div class="label">üîë auth_token (localStorage):</div>
            <div class="value" id="token"></div>
        </div>

        <div class="info-block">
            <div class="label">üìä Statut du token:</div>
            <div class="value" id="status"></div>
        </div>

        <div class="info-block">
            <div class="label">üíæ Toutes les cl√©s dans localStorage:</div>
            <div class="value" id="allKeys"></div>
        </div>

        <div class="info-block">
            <div class="label">üç™ Cookies du domaine:</div>
            <div class="value" id="cookies"></div>
        </div>

        <button onclick="testAPI()">üî¨ Tester l'API /auth/me</button>

        <div id="apiResult" style="margin-top: 20px;"></div>
    </div>

    <script>
        // Afficher le domaine
        document.getElementById('domain').textContent = window.location.hostname;

        // Afficher l'URL de l'API
        const hostname = window.location.hostname;
        const apiUrl = (hostname === 'localhost' || hostname === '127.0.0.1')
            ? 'http://localhost:3000/api'
            : `${window.location.origin}/api`;
        document.getElementById('apiUrl').textContent = apiUrl;

        // R√©cup√©rer le token (v√©rifier les deux cl√©s possibles)
        const authToken = localStorage.getItem('auth_token');
        const token = localStorage.getItem('token');

        let displayToken = authToken || token;

        if (displayToken) {
            document.getElementById('token').innerHTML = `
                <strong>auth_token:</strong> ${authToken ? authToken.substring(0, 50) + '...' + authToken.substring(authToken.length - 20) : 'NULL'}<br><br>
                <strong>token:</strong> ${token ? token.substring(0, 50) + '...' + token.substring(token.length - 20) : 'NULL'}
            `;
            document.getElementById('status').innerHTML = '<span class="success">‚úÖ Token trouv√© sous la cl√©: ' + (authToken ? 'auth_token' : 'token') + '</span>';
        } else {
            document.getElementById('token').textContent = 'NULL (aucun token trouv√© sous auth_token ou token)';
            document.getElementById('status').innerHTML = '<span class="warning">‚ùå Pas de token ! Tu dois te reconnecter.</span>';
        }

        // Afficher toutes les cl√©s
        const allKeys = Object.keys(localStorage);
        if (allKeys.length === 0) {
            document.getElementById('allKeys').textContent = 'LocalStorage est vide';
        } else {
            document.getElementById('allKeys').textContent = allKeys.join(', ');
        }

        // Afficher les cookies
        const cookies = document.cookie;
        if (cookies) {
            document.getElementById('cookies').textContent = cookies;
        } else {
            document.getElementById('cookies').textContent = 'Aucun cookie trouv√©';
        }

        // Fonction pour tester l'API
        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            const authToken = localStorage.getItem('auth_token');
            const token = localStorage.getItem('token');
            const finalToken = authToken || token;

            if (!finalToken) {
                resultDiv.innerHTML = `
                    <div class="info-block">
                        <div class="label">‚ùå Erreur:</div>
                        <div class="value warning">Pas de token disponible. Impossible de tester l'API.</div>
                    </div>
                `;
                return;
            }

            resultDiv.innerHTML = `
                <div class="info-block">
                    <div class="label">‚è≥ Test en cours...</div>
                </div>
            `;

            const hostname = window.location.hostname;
            const API_URL = (hostname === 'localhost' || hostname === '127.0.0.1')
                ? 'http://localhost:3000/api'
                : `${window.location.origin}/api`;

            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${finalToken}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="info-block">
                            <div class="label">‚úÖ R√©ponse API (Status ${response.status}):</div>
                            <div class="value success">${JSON.stringify(data, null, 2)}</div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="info-block">
                            <div class="label">‚ùå Erreur API (Status ${response.status}):</div>
                            <div class="value warning">${JSON.stringify(data, null, 2)}</div>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="info-block">
                        <div class="label">‚ùå Erreur r√©seau:</div>
                        <div class="value warning">${error.message}</div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
